name: ðŸŒ™ Nightly Performance Tests

on:
  schedule:
    # Run every night at 3AM UTC
    - cron: '0 3 * * *'
  workflow_dispatch:

permissions:
  checks: write
  contents: read
  packages: write
  pull-requests: write

jobs:
  # nightly-performance-tests:
  #   name: "ðŸš€ Nightly Performance Tests"
  #   uses: ./.github/workflows/run-perf-tests.yml
  #   secrets: inherit

  report-failure:
    name: "ðŸ”” Report failure"
    runs-on: ubuntu-latest
    if: ${{ always() }}
    steps:
      - name: Construct message
        id: message
        run: |
          COMMIT_URL="https://github.com/tenstorrent/tt-metal/commit/${{ github.sha }}"
          RUN_BASE="${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
          RUN_URL="$RUN_BASE/job/${{ job.check_run_id }}"
          MESSAGE=":alert: Hey, just so you know \`${{ github.event.sender.login }}\` broke ${{ github.workflow }}"
          MESSAGE="$MESSAGE with $COMMIT_URL at $RUN_URL"
          echo "text=$MESSAGE" >> $GITHUB_OUTPUT
      - name: Send Slack notification
        uses: slackapi/slack-github-action@v2.1.1
        with:
          method: chat.postMessage
          token: ${{ secrets.SLACK_BOT_TOKEN }}
          payload: |
            {
              "channel": "${{ secrets.SLACK_CHANNEL_ID }}",
              "text": "${{ steps.message.outputs.text }}"
            }
