#define FUSED_TEST
#include "ckernel.h"
#include "llk_defs.h"
#include "ckernel_debug.h"
#include "ckernel_defs.h"
#include "ckernel_sfpu.h"
#include "tensix_types.h"
#include "operand.h"

uint32_t unp_cfg_context          = 0;
uint32_t pack_sync_tile_dst_ptr   = 0;
uint32_t math_sync_tile_dst_index = 0;

inline uint32_t L1_ADDRESS(uint32_t buffer_address)
{
#ifdef ARCH_QUASAR
    return buffer_address / 16;
#else
    return (buffer_address / 16) - 1;
#endif
}

#define UNUSED __attribute__((unused))


#ifdef LLK_TRISC_UNPACK

#include "llk_unpack_A.h"
#include "llk_unpack_AB.h"
#include "llk_unpack_AB_matmul.h"
#include "llk_unpack_common.h"
#include "llk_unpack_tilize.h"

void run_kernel(const volatile struct RuntimeParams* params)
{
    // Operation 0: UnpackerA
    UNUSED const Operand buffer_A0(0x1a000, 2048);
    UNUSED const Operand buffer_B0(0x1c000, 2048);
    UNUSED const uint32_t unpack_a_src_format0 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    UNUSED const uint32_t unpack_a_dst_format0 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    UNUSED const uint32_t unpack_b_src_format0 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    UNUSED const uint32_t unpack_b_dst_format0 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    _llk_unpack_hw_configure_<true, false>(
        unpack_a_src_format0, unpack_b_src_format0, unpack_a_dst_format0, unpack_b_dst_format0,
        16, 16, 4, 4, 128, 128
    );
    _llk_unpack_A_init_<BroadcastType::NONE, false, EltwiseBinaryReuseDestType::NONE, false>(
        false, true, 16, 4, unpack_a_src_format0, unpack_a_dst_format0
    );
    for (int i = 0; i < 4; ++i)
    {
        _llk_unpack_A_<BroadcastType::NONE, false, EltwiseBinaryReuseDestType::NONE, false>(
            L1_ADDRESS(buffer_A0[i]), unpack_a_src_format0, unpack_a_dst_format0
        );
    }

    t6_semaphore_wait_on_zero<p_stall::STALL_SYNC>(semaphore::PACK_DONE);
    t6_semaphore_get<>(semaphore::PACK_DONE);

    // Operation 1: UnpackerTilizeA
    UNUSED const Operand buffer_A1(0x1e000, 2048);
    UNUSED const Operand buffer_B1(0x1c000, 2048);
    UNUSED const uint32_t unpack_a_src_format1 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    UNUSED const uint32_t unpack_a_dst_format1 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    UNUSED const uint32_t unpack_b_src_format1 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    UNUSED const uint32_t unpack_b_dst_format1 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    _llk_unpack_reconfig_data_format_srca_impl_<true, false>(
        unpack_a_src_format1, unpack_a_dst_format1, 128
    );
    _llk_unpack_reconfig_data_format_srcb_impl_<true, false>(
        unpack_b_src_format1, unpack_b_dst_format1, 128
    );
    _llk_unpack_tilize_init_(unpack_a_src_format1, unpack_a_dst_format1, 2, 16, false);
    for (uint32_t i = 0; i < 2; i++)
    {
        for (uint32_t j = 0; j < 2; j++)
        {
            _llk_unpack_tilize_(L1_ADDRESS(buffer_A1[i * 2]), j, unpack_a_src_format1, 2, 16, 4, false);
        }
    }
    _llk_unpack_tilize_uninit_(unpack_a_dst_format1, 16);

    t6_semaphore_wait_on_zero<p_stall::STALL_SYNC>(semaphore::PACK_DONE);
    t6_semaphore_get<>(semaphore::PACK_DONE);

    // Operation 2: UnpackerAB
    UNUSED const Operand buffer_A2(0x20000, 2048);
    UNUSED const Operand buffer_B2(0x22000, 2048);
    UNUSED const uint32_t unpack_a_src_format2 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    UNUSED const uint32_t unpack_a_dst_format2 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    UNUSED const uint32_t unpack_b_src_format2 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    UNUSED const uint32_t unpack_b_dst_format2 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    _llk_unpack_reconfig_data_format_srca_impl_<true, false>(
        unpack_a_src_format2, unpack_a_dst_format2, 128
    );
    _llk_unpack_reconfig_data_format_srcb_impl_<true, false>(
        unpack_b_src_format2, unpack_b_dst_format2, 128
    );
    cfg_reg_rmw_tensix<THCON_SEC0_REG2_Haloize_mode_RMW>(0);
    constexpr std::uint32_t UNP_SEL = p_setadc::UNP_AB;
    config_unpacker_x_end<UNP_SEL>(16);
    _llk_unpack_AB_mop_config_<BroadcastType::NONE>(false, 4, false);
    for (int i = 0; i < 4; i++)
    {
        _llk_unpack_AB_<>(L1_ADDRESS(buffer_A2[i]), L1_ADDRESS(buffer_B2[i]));
    }

    t6_semaphore_wait_on_zero<p_stall::STALL_SYNC>(semaphore::PACK_DONE);
    t6_semaphore_get<>(semaphore::PACK_DONE);

    // Operation 3: UnpackerAB
    UNUSED const Operand buffer_A3(0x24000, 2048);
    UNUSED const Operand buffer_B3(0x1c000, 2048);
    UNUSED const uint32_t unpack_a_src_format3 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    UNUSED const uint32_t unpack_a_dst_format3 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    UNUSED const uint32_t unpack_b_src_format3 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    UNUSED const uint32_t unpack_b_dst_format3 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    _llk_unpack_reconfig_data_format_srca_impl_<true, false>(
        unpack_a_src_format3, unpack_a_dst_format3, 128
    );
    _llk_unpack_reconfig_data_format_srcb_impl_<true, false>(
        unpack_b_src_format3, unpack_b_dst_format3, 128
    );
    _llk_unpack_AB_init_<BroadcastType::NONE>(16, 4, false, true);
    for (int i = 0; i < 4; i++)
    {
        _llk_unpack_AB_<>(L1_ADDRESS(buffer_A3[i]), L1_ADDRESS(buffer_B3[i]));
    }

    t6_semaphore_wait_on_zero<p_stall::STALL_SYNC>(semaphore::PACK_DONE);
    t6_semaphore_get<>(semaphore::PACK_DONE);

    // Operation 4: MatmulUnpacker
    UNUSED const Operand buffer_A4(0x26000, 2048);
    UNUSED const Operand buffer_B4(0x1e000, 2048);
    UNUSED const uint32_t unpack_a_src_format4 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    UNUSED const uint32_t unpack_a_dst_format4 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    UNUSED const uint32_t unpack_b_src_format4 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    UNUSED const uint32_t unpack_b_dst_format4 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    _llk_unpack_reconfig_data_format_srca_impl_<true, false>(
        unpack_a_src_format4, unpack_a_dst_format4, 128
    );
    _llk_unpack_reconfig_data_format_srcb_impl_<true, false>(
        unpack_b_src_format4, unpack_b_dst_format4, 128
    );
    _llk_unpack_AB_matmul_init_<>(false, 2, 2, 2, 16, 16);
    for (uint32_t j = 0; j < 2; j++)
    {
        _llk_unpack_AB_matmul_<>(
            L1_ADDRESS(buffer_A4[0]), L1_ADDRESS(buffer_B4[0]),
            j, j * 2, 128, 128, false, false, 2, 2, 2
        );
    }

    t6_semaphore_wait_on_zero<p_stall::STALL_SYNC>(semaphore::PACK_DONE);
    t6_semaphore_get<>(semaphore::PACK_DONE);

    // Operation 5: MatmulUnpacker
    UNUSED const Operand buffer_A5(0x28000, 4096);
    UNUSED const Operand buffer_B5(0x2c000, 4096);
    UNUSED const uint32_t unpack_a_src_format5 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float32);
    UNUSED const uint32_t unpack_a_dst_format5 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Tf32);
    UNUSED const uint32_t unpack_b_src_format5 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float32);
    UNUSED const uint32_t unpack_b_dst_format5 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Tf32);
    _llk_unpack_reconfig_data_format_srca_impl_<true, false>(
        unpack_a_src_format5, unpack_a_dst_format5, 256
    );
    _llk_unpack_reconfig_data_format_srcb_impl_<true, false>(
        unpack_b_src_format5, unpack_b_dst_format5, 256
    );
    _llk_unpack_AB_matmul_init_<>(true, 2, 2, 2, 16, 16);
    for (uint32_t j = 0; j < 2; j++)
    {
        _llk_unpack_AB_matmul_<>(
            L1_ADDRESS(buffer_A5[0]), L1_ADDRESS(buffer_B5[0]),
            j, j * 2, 256, 256, false, false, 2, 2, 2
        );
    }

}

#endif

#ifdef LLK_TRISC_MATH

#include "ckernel_defs.h"
#include "ckernel_sfpu.h"
#include "ckernel_sfpu_binary.h"
#include "llk_math_common.h"
#include "llk_math_eltwise_binary.h"
#include "llk_math_eltwise_binary_sfpu.h"
#include "llk_math_eltwise_unary_datacopy.h"
#include "llk_math_eltwise_unary_sfpu.h"
#include "llk_math_matmul.h"
#include "llk_math_reduce.h"
#include "sfpu_operations.h"

void run_kernel(const volatile struct RuntimeParams* params)
{
    // Operation 0: Math Setup
    const uint32_t math_format0 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    const DstSync dest_sync0 = DstSync::SyncHalf;
    _llk_math_hw_configure_<true>(math_format0, math_format0);
    _llk_math_pack_sync_init_<dest_sync0, true>();

    // Operation 0: Datacopy FPU
    _llk_math_eltwise_unary_datacopy_init_<DataCopyType::A2D, true, BroadcastType::NONE, true>(
        4, math_format0
    );
    _llk_math_wait_for_dest_available_<dest_sync0>();
    for (int i = 0; i < 4; ++i)
    {
        _llk_math_eltwise_unary_datacopy_<DataCopyType::A2D, dest_sync0, true, BroadcastType::NONE, false>(
            0 + i, math_format0, math_format0);
    }

    _llk_math_dest_section_done_<dest_sync0, true>();

    // Operation 1: Math Setup
    const uint32_t math_format1 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    const DstSync dest_sync1 = DstSync::SyncHalf;
    _llk_math_reconfig_data_format_<true, false>(math_format1, math_format1);
    _llk_math_pack_sync_init_<dest_sync1, true>();

    // Operation 1: Datacopy FPU
    _llk_math_eltwise_unary_datacopy_init_<DataCopyType::A2D, true, BroadcastType::NONE, true>(
        4, math_format1
    );
    _llk_math_wait_for_dest_available_<dest_sync1>();
    for (int i = 0; i < 4; ++i)
    {
        _llk_math_eltwise_unary_datacopy_<DataCopyType::A2D, dest_sync1, true, BroadcastType::NONE, false>(
            0 + i, math_format1, math_format1);
    }

    // Operation 1: Unary exponential SFPU
    _llk_math_eltwise_unary_sfpu_init_<SfpuType::exponential>();
    _llk_math_eltwise_unary_sfpu_start_<dest_sync1>(0);
    test_utils::call_sfpu_operation<false, true, 128>(SfpuType::exponential, math_format1);
    _llk_math_eltwise_unary_sfpu_done_();

    // Operation 1: Unary celu SFPU
    _llk_math_eltwise_unary_sfpu_init_<SfpuType::celu>();
    _llk_math_eltwise_unary_sfpu_start_<dest_sync1>(0);
    test_utils::call_sfpu_operation<false, true, 128>(SfpuType::celu, math_format1);
    _llk_math_eltwise_unary_sfpu_done_();

    // Operation 1: Binary ADD SFPU
    _llk_math_eltwise_binary_sfpu_init_<SfpuType::add1>();
    _llk_math_eltwise_binary_sfpu_start_<dest_sync1>(0);
    test_utils::call_binary_sfpu_operation<false, ckernel::BinaryOp::ADD, 32, math_format1>(0, 1, 1);
    _llk_math_eltwise_binary_sfpu_done_();

    _llk_math_dest_section_done_<dest_sync1, true>();

    // Operation 2: Math Setup
    const uint32_t math_format2 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    const DstSync dest_sync2 = DstSync::SyncHalf;
    _llk_math_reconfig_data_format_<true, false>(math_format2, math_format2);
    _llk_math_pack_sync_init_<dest_sync2, true>();

    // Operation 2: Reduce REDUCE_COL FPU
    _llk_math_reduce_init_<PoolType::MAX, ReduceDim::REDUCE_COL, true, 4, false>();
    _llk_math_wait_for_dest_available_<dest_sync2>();
    for (int i = 0; i < 4; ++i)
    {
        _llk_math_reduce_<PoolType::MAX, ReduceDim::REDUCE_COL, true, 4, false, false>(
            i, false, 4
        );
    }
    _llk_math_reduce_uninit_(static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b));

    // Operation 2: Binary ADD SFPU
    _llk_math_eltwise_binary_sfpu_init_<SfpuType::add1>();
    _llk_math_eltwise_binary_sfpu_start_<dest_sync2>(0);
    test_utils::call_binary_sfpu_operation<false, ckernel::BinaryOp::ADD, 8, math_format2>(0, 1, 2);
    _llk_math_eltwise_binary_sfpu_done_();

    _llk_math_dest_section_done_<dest_sync2, true>();

    // Operation 3: Math Setup
    const uint32_t math_format3 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    const DstSync dest_sync3 = DstSync::SyncFull;
    _llk_math_reconfig_data_format_<true, false>(math_format3, math_format3);
    _llk_math_pack_sync_init_<dest_sync3, true>();

    // Operation 3: Eltwise ELWADD FPU
    _llk_math_eltwise_binary_init_<ckernel::EltwiseBinaryType::ELWADD, BroadcastType::NONE, 3>(4, 0);
    _llk_math_wait_for_dest_available_<dest_sync3>();
    for (int i = 0; i < 4; i++)
    {
        _llk_math_eltwise_binary_<ELWADD, BroadcastType::NONE, dest_sync3,
            true, 3, EltwiseBinaryReuseDestType::NONE>(4, i, false);
    }

    // Operation 3: Unary neg SFPU
    _llk_math_eltwise_unary_sfpu_init_<SfpuType::neg>();
    _llk_math_eltwise_unary_sfpu_start_<dest_sync3>(0);
    test_utils::call_sfpu_operation<false, true, 128>(SfpuType::neg, math_format3);
    _llk_math_eltwise_unary_sfpu_done_();

    _llk_math_dest_section_done_<dest_sync3, true>();

    // Operation 4: Math Setup
    const uint32_t math_format4 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    const DstSync dest_sync4 = DstSync::SyncHalf;
    _llk_math_reconfig_data_format_<true, false>(math_format4, math_format4);
    _llk_math_pack_sync_init_<dest_sync4, true>();

    // Operation 4: Matmul FPU
    _llk_math_matmul_init_<2>(
        TILE_R_DIM, TILE_C_DIM, TILE_R_DIM, TILE_C_DIM, false, false, 2, 2
    );
    _llk_math_wait_for_dest_available_<dest_sync4>();
    for (uint32_t j = 0; j < 2; j++)
    {
        _llk_math_matmul_<2>(0, 2, 2);
    }

    // Operation 4: Unary abs SFPU
    _llk_math_eltwise_unary_sfpu_init_<SfpuType::abs>();
    _llk_math_eltwise_unary_sfpu_start_<dest_sync4>(0);
    test_utils::call_sfpu_operation<false, true, 128>(SfpuType::abs, math_format4);
    _llk_math_eltwise_unary_sfpu_done_();

    // Operation 4: Unary sqrt SFPU
    _llk_math_eltwise_unary_sfpu_init_<SfpuType::sqrt>();
    _llk_math_eltwise_unary_sfpu_start_<dest_sync4>(0);
    test_utils::call_sfpu_operation<false, true, 128>(SfpuType::sqrt, math_format4);
    _llk_math_eltwise_unary_sfpu_done_();

    _llk_math_dest_section_done_<dest_sync4, true>();

    // Operation 5: Math Setup
    const uint32_t math_format5 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Tf32);
    const DstSync dest_sync5 = DstSync::SyncHalf;
    _llk_math_reconfig_data_format_<true, false>(math_format5, math_format5);
    _llk_math_pack_sync_init_<dest_sync5, true>();

    // Operation 5: Matmul FPU
    _llk_math_matmul_init_<0>(
        TILE_R_DIM, TILE_C_DIM, TILE_R_DIM, TILE_C_DIM, false, true, 2, 2
    );
    _llk_math_wait_for_dest_available_<dest_sync5>();
    for (uint32_t j = 0; j < 2; j++)
    {
        _llk_math_matmul_<0>(0, 2, 2);
    }

    // Operation 5: Unary sqrt SFPU
    _llk_math_eltwise_unary_sfpu_init_<SfpuType::sqrt>();
    _llk_math_eltwise_unary_sfpu_start_<dest_sync5>(0);
    test_utils::call_sfpu_operation<false, true, 128>(SfpuType::sqrt, math_format5);
    _llk_math_eltwise_unary_sfpu_done_();

    // Operation 5: Binary ADD SFPU
    _llk_math_eltwise_binary_sfpu_init_<SfpuType::add1>();
    _llk_math_eltwise_binary_sfpu_start_<dest_sync5>(0);
    test_utils::call_binary_sfpu_operation<false, ckernel::BinaryOp::ADD, 128, math_format5>(0, 0, 0);
    _llk_math_eltwise_binary_sfpu_done_();

    _llk_math_dest_section_done_<dest_sync5, true>();

}

#endif

#ifdef LLK_TRISC_PACK

#include "llk_pack.h"
#include "llk_pack_common.h"

void run_kernel(const volatile struct RuntimeParams* params)
{
    // Operation 0: Packer
    const Operand buffer_Res0(0x1e000, 2048);
    const uint32_t pack_src_format0 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    const uint32_t pack_dst_format0 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    _llk_pack_hw_configure_<true, false>(
        pack_src_format0, pack_dst_format0, 128
    );
    _llk_pack_init_<false, false>(
        pack_dst_format0
    );
    _llk_pack_dest_init_<DstSync::SyncHalf, true, false>();
    _llk_packer_wait_for_math_done_();
    for (int i = 0; i < 4; i++)
    {
        _llk_pack_<DstSync::SyncHalf, true, false>(i, L1_ADDRESS(buffer_Res0[i]));
    }
    _llk_pack_dest_section_done_<DstSync::SyncHalf, true>();
    t6_semaphore_post<>(semaphore::PACK_DONE);

    // Operation 1: Packer
    const Operand buffer_Res1(0x20000, 2048);
    const uint32_t pack_src_format1 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    const uint32_t pack_dst_format1 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    _llk_pack_reconfig_data_format_<true, false>(
        pack_src_format1, pack_dst_format1, 128
    );
    _llk_pack_init_<false, false>(
        pack_dst_format1
    );
    _llk_pack_dest_init_<DstSync::SyncHalf, true, false>();
    _llk_packer_wait_for_math_done_();
    for (int i = 0; i < 4; i++)
    {
        _llk_pack_<DstSync::SyncHalf, true, false>(i, L1_ADDRESS(buffer_Res1[i]));
    }
    _llk_pack_dest_section_done_<DstSync::SyncHalf, true>();
    t6_semaphore_post<>(semaphore::PACK_DONE);

    // Operation 2: Packer
    const Operand buffer_Res2(0x24000, 2048);
    const uint32_t pack_src_format2 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    const uint32_t pack_dst_format2 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    _llk_pack_reconfig_data_format_<true, false>(
        pack_src_format2, pack_dst_format2, 128
    );
    _llk_pack_init_<false, false>(
        pack_dst_format2
    );
    _llk_pack_dest_init_<DstSync::SyncHalf, true, false>();
    _llk_pack_reduce_mask_config_<false, ReduceDim::REDUCE_COL>();
    _llk_packer_wait_for_math_done_();
    for (int i = 0; i < 4; i++)
    {
        _llk_pack_<DstSync::SyncHalf, true, false>(i, L1_ADDRESS(buffer_Res2[i]));
    }
    _llk_pack_dest_section_done_<DstSync::SyncHalf, true>();
    _llk_pack_reduce_mask_clear_();
    t6_semaphore_post<>(semaphore::PACK_DONE);

    // Operation 3: Packer
    const Operand buffer_Res3(0x26000, 2048);
    const uint32_t pack_src_format3 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    const uint32_t pack_dst_format3 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float16_b);
    _llk_pack_reconfig_data_format_<true, false>(
        pack_src_format3, pack_dst_format3, 128
    );
    _llk_pack_init_<false, false>(
        pack_dst_format3
    );
    _llk_pack_dest_init_<DstSync::SyncFull, true, false>();
    _llk_packer_wait_for_math_done_();
    for (int i = 0; i < 4; i++)
    {
        _llk_pack_<DstSync::SyncHalf, true, false>(i, L1_ADDRESS(buffer_Res3[i]));
    }
    _llk_pack_dest_section_done_<DstSync::SyncHalf, true>();
    t6_semaphore_post<>(semaphore::PACK_DONE);

    // Operation 4: Packer
    const Operand buffer_Res4(0x28000, 4096);
    const uint32_t pack_src_format4 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float32);
    const uint32_t pack_dst_format4 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float32);
    _llk_pack_reconfig_data_format_<true, false>(
        pack_src_format4, pack_dst_format4, 256
    );
    _llk_pack_init_<false, false>(
        pack_dst_format4
    );
    _llk_pack_dest_init_<DstSync::SyncHalf, true, false>();
    _llk_packer_wait_for_math_done_();
    for (int i = 0; i < 4; i++)
    {
        _llk_pack_<DstSync::SyncHalf, true, false>(i, L1_ADDRESS(buffer_Res4[i]));
    }
    _llk_pack_dest_section_done_<DstSync::SyncHalf, true>();
    t6_semaphore_post<>(semaphore::PACK_DONE);

    // Operation 5: Packer
    const Operand buffer_Res5(0x30000, 4096);
    const uint32_t pack_src_format5 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float32);
    const uint32_t pack_dst_format5 = static_cast<std::underlying_type_t<DataFormat>>(DataFormat::Float32);
    _llk_pack_reconfig_data_format_<true, false>(
        pack_src_format5, pack_dst_format5, 256
    );
    _llk_pack_init_<false, false>(
        pack_dst_format5
    );
    _llk_pack_dest_init_<DstSync::SyncHalf, true, false>();
    _llk_packer_wait_for_math_done_();
    for (int i = 0; i < 4; i++)
    {
        _llk_pack_<DstSync::SyncHalf, true, false>(i, L1_ADDRESS(buffer_Res5[i]));
    }
    _llk_pack_dest_section_done_<DstSync::SyncHalf, true>();
}

#endif
